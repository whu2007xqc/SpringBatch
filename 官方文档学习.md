## 3. Domain Language of Batch
### Job
job的层次依次分为Job、JobInstance，JobExecution。

> In Spring Batch, a Job is simply a container for Step instances. It combines multiple steps that belong logically together in a flow and allows for configuration of properties global to all steps, such as restartability. The job configuration contains:
> * The simple name of the job.  
> * Definition and ordering of Step instances.  
> * Whether or not the job is restartable.  

创建一个SimpleJob：
```java
@Bean
public Job footballJob() {
    return this.jobBuilderFactory.get("footballJob")
                     .start(playerLoad())
                     .next(gameLoad())
                     .next(playerSummarization())
                     .build();
}
```

#### JobParameter
> "How is one JobInstance distinguished from another?" The answer is: JobParameters. 
> A JobParameters object holds a set of parameters used to start a batch job. They can be used for identification or even as reference data during the run.
> Thus, the contract can be defined as: **JobInstance = Job + identifying JobParameters** .

注意JobExecution参数：  
* Status： A `BatchStatus` object that indicates the status of the execution. While running, it is BatchStatus#STARTED. If it fails, it is BatchStatus#FAILED. If it finishes successfully, it is BatchStatus#COMPLETED

### Step
> As with a Job, a Step has an individual StepExecution that correlates with a unique JobExecution.
> if a step fails to execute because the step before it fails, no execution is persisted for it. A StepExecution is created only when its Step is actually started.

#### StepExecution
参数列表参考：
https://docs.spring.io/spring-batch/docs/current/reference/html/index-single.html#stepexecution

### ExecutionContext
Job和Step都有对应的ExecutionContext，用于保存Job或Step的运行状态。最简单的应用场景就是重跑。  
> there is at least one ExecutionContext per JobExecution and one for every StepExecution.
> The one scoped to the Step is saved at every commit point in the Step, whereas the one scoped to the Job is saved in between every Step execution.

### JobRepository
用于持久化的工具。为JobLauncher，Job，Step提供了CRUD操作。
使用 Java 配置时，`@EnableBatchProcessing` 注释提供 JobRepository 作为开箱即用自动配置的组件之一。

### JobLauncher
> JobLauncher represents a simple interface for launching a Job with a given set of JobParameters.

## 4. Configuring and Running a Job
### Configuring a Job
#### 重复执行Restartability
禁止Job重复执行：  
```java
@Bean
public Job footballJob() {
    return this.jobBuilderFactory.get("footballJob")
                     .preventRestart()
                     ...
                     .build();
}
```

#### Listener
> It should be noted that the afterJob method is called regardless of the success or failure of the Job. If success or failure needs to be determined, it can be obtained from the JobExecution, as follows:

```java
public void afterJob(JobExecution jobExecution){
    if (jobExecution.getStatus() == BatchStatus.COMPLETED ) {
        //job success
    }
    else if (jobExecution.getStatus() == BatchStatus.FAILED) {
        //job failure
    }
}
```
注意顺序：
1. 调用beforeJob -> 2. 调用execute执行job -> 3. 调用afterJob -> 4. JobRepository持久化到DB  
其中2已经将运行状态更新到execution对象中了。  

